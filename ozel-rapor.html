<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EÄŸitim CRM - Ã–zel Rapor OluÅŸturucu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:#f8fafc; }
    .page-header { position: sticky; top: 0; background: #ffffffcc; backdrop-filter: saturate(180%) blur(6px); border-bottom: 1px solid #eef2f7; z-index: 10; }
    .card { border:1px solid #e5e7eb; box-shadow: 0 1px 2px rgba(16,24,40,.04); }
    .step-card { border-left: 4px solid #3b82f6; }
    .field-list { min-height: 200px; border: 2px dashed #d1d5db; border-radius: 8px; padding: 1rem; }
    .field-item { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 4px; padding: 0.5rem; margin: 0.25rem; cursor: move; }
    .field-item:hover { background: #e5e7eb; }
    .selected-fields { min-height: 150px; border: 2px dashed #22c55e; border-radius: 8px; padding: 1rem; background: #f0fdf4; }
    .filter-item { background: #fef3c7; border: 1px solid #f59e0b; border-radius: 4px; padding: 0.5rem; margin: 0.25rem; display: flex; justify-content: between; align-items: center; }
    .preview-container { max-height: 400px; overflow-y: auto; }
  </style>
</head>
<body>
  <header class="page-header">
    <div class="container-fluid py-3 d-flex align-items-center justify-content-between">
      <div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb mb-1">
            <li class="breadcrumb-item"><a href="index.html" class="text-decoration-none">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="raporlar.html" class="text-decoration-none">Raporlar</a></li>
            <li class="breadcrumb-item active" aria-current="page">Ã–zel Rapor OluÅŸturucu</li>
          </ol>
        </nav>
        <h1 class="h5 fw-semibold mb-0">Ã–zel Rapor OluÅŸturucu</h1>
      </div>
    </div>
  </header>

  <main class="container-fluid py-3 py-md-4">
    <form id="customReportForm">
      <!-- Step 1: Data Source -->
      <div class="card step-card mb-4">
        <div class="card-header">
          <h6 class="mb-0">ADIM 1: VERÄ° KAYNAÄI SEÃ‡Ä°N</h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="dataPersons" checked>
                <label class="form-check-label" for="dataPersons">KiÅŸiler</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="dataEducations" checked>
                <label class="form-check-label" for="dataEducations">EÄŸitimler</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="dataRegistrations">
                <label class="form-check-label" for="dataRegistrations">KayÄ±tlar</label>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="dataFinancial">
                <label class="form-check-label" for="dataFinancial">Gelir/Gider</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="dataAttendance">
                <label class="form-check-label" for="dataAttendance">Yoklamalar</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="dataExams">
                <label class="form-check-label" for="dataExams">SÄ±navlar</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: Field Selection -->
      <div class="card step-card mb-4">
        <div class="card-header">
          <h6 class="mb-0">ADIM 2: ALANLAR SEÃ‡Ä°N</h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label">Mevcut Alanlar:</label>
              <div class="field-list" id="availableFields">
                <div class="field-item" data-field="ad_soyad">Ad Soyad</div>
                <div class="field-item" data-field="tc_no">TC No</div>
                <div class="field-item" data-field="email">Email</div>
                <div class="field-item" data-field="telefon">Telefon</div>
                <div class="field-item" data-field="egitim_adi">EÄŸitim AdÄ±</div>
                <div class="field-item" data-field="katilim_yuzde">KatÄ±lÄ±m %</div>
                <div class="field-item" data-field="sinav_puani">SÄ±nav PuanÄ±</div>
                <div class="field-item" data-field="kayit_tarihi">KayÄ±t Tarihi</div>
                <div class="field-item" data-field="durum">Durum</div>
                <div class="field-item" data-field="gelir">Gelir</div>
                <div class="field-item" data-field="gider">Gider</div>
                <div class="field-item" data-field="net_kar">Net Kar</div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">SeÃ§ili Alanlar:</label>
              <div class="selected-fields" id="selectedFields">
                <div class="text-muted text-center">AlanlarÄ± buraya sÃ¼rÃ¼kleyin</div>
              </div>
              <div class="mt-2">
                <button type="button" class="btn btn-outline-secondary btn-sm" id="moveUp">â†‘ YukarÄ±</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="moveDown">â†“ AÅŸaÄŸÄ±</button>
                <button type="button" class="btn btn-outline-danger btn-sm" id="removeSelected">âœ• KaldÄ±r</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Filters -->
      <div class="card step-card mb-4">
        <div class="card-header">
          <h6 class="mb-0">ADIM 3: FÄ°LTRELER</h6>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span>Filtreler:</span>
            <button type="button" class="btn btn-outline-primary btn-sm" id="addFilter">+ Filtre Ekle</button>
          </div>
          <div id="filterList">
            <!-- Filters will be added here dynamically -->
          </div>
        </div>
      </div>

      <!-- Step 4: Grouping and Sorting -->
      <div class="card step-card mb-4">
        <div class="card-header">
          <h6 class="mb-0">ADIM 4: GRUPLANDIRMA VE SIRALAMA</h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label">GruplandÄ±rma:</label>
              <select class="form-select" id="groupBy">
                <option value="">GruplandÄ±rma yok</option>
                <option value="egitim_adi">EÄŸitim AdÄ±</option>
                <option value="kayit_tarihi">KayÄ±t Tarihi</option>
                <option value="durum">Durum</option>
                <option value="katilim_yuzde">KatÄ±lÄ±m %</option>
              </select>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">SÄ±ralama:</label>
              <div class="row g-2">
                <div class="col-8">
                  <select class="form-select" id="sortBy">
                    <option value="ad_soyad">Ad Soyad</option>
                    <option value="kayit_tarihi">KayÄ±t Tarihi</option>
                    <option value="katilim_yuzde">KatÄ±lÄ±m %</option>
                    <option value="sinav_puani">SÄ±nav PuanÄ±</option>
                  </select>
                </div>
                <div class="col-4">
                  <select class="form-select" id="sortOrder">
                    <option value="asc">Artan</option>
                    <option value="desc">Azalan</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 5: Visualization -->
      <div class="card step-card mb-4">
        <div class="card-header">
          <h6 class="mb-0">ADIM 5: GÃ–RSELLEÅTIRME</h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">Rapor Tipi:</label>
              <div class="d-flex gap-3 flex-wrap">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="reportType" value="table" id="table" checked>
                  <label class="form-check-label" for="table">Tablo</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="reportType" value="bar" id="bar">
                  <label class="form-check-label" for="bar">Ã‡ubuk Grafik</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="reportType" value="pie" id="pie">
                  <label class="form-check-label" for="pie">Pasta Grafik</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="reportType" value="line" id="line">
                  <label class="form-check-label" for="line">Ã‡izgi Grafik</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="reportType" value="combined" id="combined">
                  <label class="form-check-label" for="combined">Tablo + Grafik</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Report Name and Actions -->
      <div class="card step-card mb-4">
        <div class="card-header">
          <h6 class="mb-0">RAPOR AYARLARI</h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label" for="reportName">Rapor AdÄ±:</label>
              <input type="text" class="form-control" id="reportName" placeholder="Ã–zel rapor adÄ±nÄ± girin...">
            </div>
            <div class="col-12 d-flex gap-2">
              <button type="button" class="btn btn-outline-secondary" id="previewBtn">ğŸ‘ï¸ Ã–NÄ°ZLEME</button>
              <button type="button" class="btn btn-outline-primary" id="saveBtn">ğŸ’¾ KAYDET</button>
              <button type="button" class="btn btn-primary" id="runBtn">â–¶ï¸ Ã‡ALIÅTIR</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Preview Section -->
      <div class="card" id="previewSection" style="display: none;">
        <div class="card-header">
          <h6 class="mb-0">RAPOR Ã–NÄ°ZLEME</h6>
        </div>
        <div class="card-body">
          <div class="preview-container">
            <div id="previewContent">
              <!-- Preview content will be generated here -->
            </div>
          </div>
        </div>
      </div>
    </form>
  </main>

  <!-- Filter Modal -->
  <div class="modal fade" id="filterModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Filtre Ekle</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">Alan:</label>
              <select class="form-select" id="filterField">
                <option value="ad_soyad">Ad Soyad</option>
                <option value="egitim_adi">EÄŸitim AdÄ±</option>
                <option value="katilim_yuzde">KatÄ±lÄ±m %</option>
                <option value="sinav_puani">SÄ±nav PuanÄ±</option>
                <option value="kayit_tarihi">KayÄ±t Tarihi</option>
                <option value="durum">Durum</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">OperatÃ¶r:</label>
              <select class="form-select" id="filterOperator">
                <option value="=">EÅŸittir (=)</option>
                <option value="!=">EÅŸit DeÄŸil (!=)</option>
                <option value=">">BÃ¼yÃ¼ktÃ¼r (>)</option>
                <option value="<">KÃ¼Ã§Ã¼ktÃ¼r (<)</option>
                <option value=">=">BÃ¼yÃ¼k EÅŸit (>=)</option>
                <option value="<=">KÃ¼Ã§Ã¼k EÅŸit (<=)</option>
                <option value="like">Ä°Ã§erir (LIKE)</option>
                <option value="between">ArasÄ±nda (BETWEEN)</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">DeÄŸer:</label>
              <input type="text" class="form-control" id="filterValue" placeholder="Filtre deÄŸeri...">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="addFilterBtn">Ekle</button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Ä°ptal</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let filterModal;
    let selectedFields = [];
    let filters = [];

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
      filterModal = new bootstrap.Modal('#filterModal');
      setupDragAndDrop();
      setupEventListeners();
    });

    function setupDragAndDrop() {
      const availableFields = document.getElementById('availableFields');
      const selectedFieldsContainer = document.getElementById('selectedFields');

      // Make fields draggable
      availableFields.querySelectorAll('.field-item').forEach(item => {
        item.draggable = true;
        item.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', item.dataset.field);
        });
      });

      // Make selected fields container droppable
      selectedFieldsContainer.addEventListener('dragover', (e) => {
        e.preventDefault();
        selectedFieldsContainer.style.backgroundColor = '#dcfce7';
      });

      selectedFieldsContainer.addEventListener('dragleave', (e) => {
        selectedFieldsContainer.style.backgroundColor = '#f0fdf4';
      });

      selectedFieldsContainer.addEventListener('drop', (e) => {
        e.preventDefault();
        selectedFieldsContainer.style.backgroundColor = '#f0fdf4';
        
        const field = e.dataTransfer.getData('text/plain');
        addFieldToSelected(field);
      });
    }

    function addFieldToSelected(field) {
      if (selectedFields.includes(field)) return;
      
      selectedFields.push(field);
      updateSelectedFieldsDisplay();
    }

    function updateSelectedFieldsDisplay() {
      const container = document.getElementById('selectedFields');
      container.innerHTML = '';
      
      if (selectedFields.length === 0) {
        container.innerHTML = '<div class="text-muted text-center">AlanlarÄ± buraya sÃ¼rÃ¼kleyin</div>';
        return;
      }

      selectedFields.forEach((field, index) => {
        const fieldElement = document.createElement('div');
        fieldElement.className = 'field-item d-flex justify-content-between align-items-center';
        fieldElement.innerHTML = `
          <span>${index + 1}. ${getFieldDisplayName(field)}</span>
          <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeField(${index})">âœ•</button>
        `;
        container.appendChild(fieldElement);
      });
    }

    function getFieldDisplayName(field) {
      const names = {
        'ad_soyad': 'Ad Soyad',
        'tc_no': 'TC No',
        'email': 'Email',
        'telefon': 'Telefon',
        'egitim_adi': 'EÄŸitim AdÄ±',
        'katilim_yuzde': 'KatÄ±lÄ±m %',
        'sinav_puani': 'SÄ±nav PuanÄ±',
        'kayit_tarihi': 'KayÄ±t Tarihi',
        'durum': 'Durum',
        'gelir': 'Gelir',
        'gider': 'Gider',
        'net_kar': 'Net Kar'
      };
      return names[field] || field;
    }

    function removeField(index) {
      selectedFields.splice(index, 1);
      updateSelectedFieldsDisplay();
    }

    function setupEventListeners() {
      // Add filter button
      document.getElementById('addFilter').addEventListener('click', () => {
        filterModal.show();
      });

      // Add filter from modal
      document.getElementById('addFilterBtn').addEventListener('click', () => {
        const field = document.getElementById('filterField').value;
        const operator = document.getElementById('filterOperator').value;
        const value = document.getElementById('filterValue').value;
        
        if (!field || !operator || !value) {
          alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.');
          return;
        }

        const filter = { field, operator, value };
        filters.push(filter);
        updateFiltersDisplay();
        filterModal.hide();
        
        // Reset form
        document.getElementById('filterField').value = '';
        document.getElementById('filterOperator').value = '=';
        document.getElementById('filterValue').value = '';
      });

      // Preview button
      document.getElementById('previewBtn').addEventListener('click', () => {
        generatePreview();
      });

      // Save button
      document.getElementById('saveBtn').addEventListener('click', () => {
        const reportName = document.getElementById('reportName').value;
        if (!reportName.trim()) {
          alert('LÃ¼tfen rapor adÄ±nÄ± girin.');
          return;
        }
        alert('Rapor kaydedildi! (Demo)');
      });

      // Run button
      document.getElementById('runBtn').addEventListener('click', () => {
        if (selectedFields.length === 0) {
          alert('LÃ¼tfen en az bir alan seÃ§in.');
          return;
        }
        generatePreview();
        document.getElementById('previewSection').style.display = 'block';
      });

      // Move buttons
      document.getElementById('moveUp').addEventListener('click', () => {
        // Move selected field up
        console.log('Move up');
      });

      document.getElementById('moveDown').addEventListener('click', () => {
        // Move selected field down
        console.log('Move down');
      });

      document.getElementById('removeSelected').addEventListener('click', () => {
        selectedFields = [];
        updateSelectedFieldsDisplay();
      });
    }

    function updateFiltersDisplay() {
      const container = document.getElementById('filterList');
      container.innerHTML = '';
      
      filters.forEach((filter, index) => {
        const filterElement = document.createElement('div');
        filterElement.className = 'filter-item';
        filterElement.innerHTML = `
          <span>${index + 1}. ${getFieldDisplayName(filter.field)} ${filter.operator} ${filter.value}</span>
          <button type="button" class="btn btn-sm btn-outline-danger ms-auto" onclick="removeFilter(${index})">âœ•</button>
        `;
        container.appendChild(filterElement);
      });
    }

    function removeFilter(index) {
      filters.splice(index, 1);
      updateFiltersDisplay();
    }

    function generatePreview() {
      const reportType = document.querySelector('input[name="reportType"]:checked').value;
      const previewContent = document.getElementById('previewContent');
      
      let html = '<h6>Rapor Ã–nizleme</h6>';
      
      if (reportType === 'table' || reportType === 'combined') {
        html += `
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  ${selectedFields.map(field => `<th>${getFieldDisplayName(field)}</th>`).join('')}
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Ahmet YILMAZ</td>
                  <td>YTÃœ EditÃ¶rlÃ¼k</td>
                  <td>100%</td>
                  <td>95</td>
                </tr>
                <tr>
                  <td>AyÅŸe DEMÄ°R</td>
                  <td>CRM Sistemi</td>
                  <td>98%</td>
                  <td>92</td>
                </tr>
                <tr>
                  <td>Mehmet KAYA</td>
                  <td>Proje YÃ¶netimi</td>
                  <td>97%</td>
                  <td>90</td>
                </tr>
              </tbody>
            </table>
          </div>
        `;
      }
      
      if (reportType === 'bar' || reportType === 'pie' || reportType === 'line' || reportType === 'combined') {
        html += `
          <div class="mt-3">
            <h6>Grafik GÃ¶rÃ¼nÃ¼mÃ¼</h6>
            <div class="alert alert-info">
              <i class="fa-solid fa-chart-bar me-2"></i>
              ${reportType === 'bar' ? 'Ã‡ubuk Grafik' : 
                reportType === 'pie' ? 'Pasta Grafik' : 
                reportType === 'line' ? 'Ã‡izgi Grafik' : 'Grafik'} burada gÃ¶rÃ¼ntÃ¼lenecek
            </div>
          </div>
        `;
      }
      
      previewContent.innerHTML = html;
    }
  </script>
</body>
</html>

